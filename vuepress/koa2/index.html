<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>全栈开发实战：用Vue+Koa2开发完整的前后端项目 | GongJS</title>
    <meta name="description" content="Talk is cheap. Show me the code.">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.29665281.css" as="style"><link rel="preload" href="/assets/js/app.e2588eef.js" as="script"><link rel="preload" href="/assets/js/13.3a3e1803.js" as="script"><link rel="prefetch" href="/assets/js/2.8e0e2f43.js"><link rel="prefetch" href="/assets/js/3.b424bb0b.js"><link rel="prefetch" href="/assets/js/4.93c61e3c.js"><link rel="prefetch" href="/assets/js/5.646d558f.js"><link rel="prefetch" href="/assets/js/6.45646660.js"><link rel="prefetch" href="/assets/js/7.5118cd21.js"><link rel="prefetch" href="/assets/js/8.28ecf96a.js"><link rel="prefetch" href="/assets/js/9.b44fd282.js"><link rel="prefetch" href="/assets/js/10.4c2b1a02.js"><link rel="prefetch" href="/assets/js/11.03eb03e8.js"><link rel="prefetch" href="/assets/js/12.093f3250.js"><link rel="prefetch" href="/assets/js/14.78b82e2b.js"><link rel="prefetch" href="/assets/js/15.23f47b02.js"><link rel="prefetch" href="/assets/js/16.a9b693ee.js">
    <link rel="stylesheet" href="/assets/css/0.styles.29665281.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">GongJS</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress/" class="nav-link">vuepress</a></li><li class="dropdown-item"><!----> <a href="/koa2/" class="nav-link router-link-exact-active router-link-active">koa2</a></li><li class="dropdown-item"><!----> <a href="/JS/" class="nav-link">JS</a></li></ul></div></div><div class="nav-item"><a href="/project/" class="nav-link">Project</a></div><div class="nav-item"><a href="/resume/" class="nav-link">Resume</a></div><div class="nav-item"><a href="/friends/" class="nav-link">Friends</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div> <a href="https://github.com/gongjs/Vue_Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress/" class="nav-link">vuepress</a></li><li class="dropdown-item"><!----> <a href="/koa2/" class="nav-link router-link-exact-active router-link-active">koa2</a></li><li class="dropdown-item"><!----> <a href="/JS/" class="nav-link">JS</a></li></ul></div></div><div class="nav-item"><a href="/project/" class="nav-link">Project</a></div><div class="nav-item"><a href="/resume/" class="nav-link">Resume</a></div><div class="nav-item"><a href="/friends/" class="nav-link">Friends</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div> <a href="https://github.com/gongjs/Vue_Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div class="carbon-ads"></div> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>全栈开发实战：用Vue+Koa2开发完整的前后端项目</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/koa2/#项目主要技术栈分析" class="sidebar-link">项目主要技术栈分析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/koa2/#项目结构" class="sidebar-link">项目结构</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/koa2/#启动koa服务" class="sidebar-link">启动koa服务</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/koa2/#构建前端页面" class="sidebar-link">构建前端页面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/koa2/#登录界面" class="sidebar-link">登录界面</a></li><li class="sidebar-sub-header"><a href="/koa2/#后台管理界面" class="sidebar-link">后台管理界面</a></li></ul></li><li><a href="/koa2/#搭建后端环境" class="sidebar-link">搭建后端环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/koa2/#mysql" class="sidebar-link">mysql</a></li><li class="sidebar-sub-header"><a href="/koa2/#sequelize" class="sidebar-link">Sequelize</a></li><li class="sidebar-sub-header"><a href="/koa2/#测试api" class="sidebar-link">测试API</a></li></ul></li><li><a href="/koa2/#登录功能" class="sidebar-link">登录功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/koa2/#axios" class="sidebar-link">Axios</a></li><li class="sidebar-sub-header"><a href="/koa2/#bcryptjs-密码加密" class="sidebar-link">bcryptjs-密码加密</a></li><li class="sidebar-sub-header"><a href="/koa2/#跨域" class="sidebar-link">跨域</a></li><li class="sidebar-sub-header"><a href="/koa2/#路由拦截" class="sidebar-link">路由拦截</a></li></ul></li><li><a href="/koa2/#实现员工的增删改查" class="sidebar-link">实现员工的增删改查</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/koa2/#发送token" class="sidebar-link">发送Token</a></li><li class="sidebar-sub-header"><a href="/koa2/#获取数据" class="sidebar-link">获取数据</a></li><li class="sidebar-sub-header"><a href="/koa2/#添加数据、更新数据、删除数据" class="sidebar-link">添加数据、更新数据、删除数据</a></li><li class="sidebar-sub-header"><a href="/koa2/#数据查找" class="sidebar-link">数据查找</a></li></ul></li><li><a href="/koa2/#项目部署" class="sidebar-link">项目部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/koa2/#webpack打包" class="sidebar-link">webpack打包</a></li><li class="sidebar-sub-header"><a href="/koa2/#koa托管静态资源" class="sidebar-link">koa托管静态资源</a></li></ul></li><li><a href="/koa2/#写在最后" class="sidebar-link">写在最后</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div id="area" class="page"> <div class="content"><h1 id="全栈开发实战：用vue-koa2开发完整的前后端项目"><a href="#全栈开发实战：用vue-koa2开发完整的前后端项目" aria-hidden="true" class="header-anchor">#</a> 全栈开发实战：用Vue+Koa2开发完整的前后端项目</h1> <p>花了差不多一个月的时间，从0开始撸了一个基于<code>vue</code>、<code>koa2</code>、<code>mysql</code>、<code>antd</code>前后端分离的后台管理系统。在看本教程之前，要求你对vue和koa(可参考<a href="https://camp.qianduan.group/koa2/2/0/0" target="_blank" rel="noopener noreferrer">ikcamp<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>出品的node入门教程)有一定的了解，通过本文能了解到Vue如何构建单页面应用、antd在后台管理系统中的应用、Koa2如何通过API与Vue前端进行数据的交互、以及用Sequelize来操作MySQL数据库等知识技巧。另外作者本人也只是刚入行前端半年多的小白，在写本教程的时候可能会有考虑不周甚至错误的地方，恳请大家指证，最后希望本文能给想自己完成一个从前端到后端、数据库完整作品的同学带来帮助。</p> <p><a href="http://132.232.73.32:3000/#/home" target="_blank" rel="noopener noreferrer">完整项目预览<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/GongJS/vue-antd-management" target="_blank" rel="noopener noreferrer">github地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>体验账号：<code>redell</code>   密码：<code>123</code></p> <div style="text-align: center"><img src="/assets/img/admin.4a2c876f.gif"></div> <h2 id="项目主要技术栈分析"><a href="#项目主要技术栈分析" aria-hidden="true" class="header-anchor">#</a> 项目主要技术栈分析</h2> <ul><li>&quot;vue&quot;: &quot;^2.5.2&quot;</li> <li>&quot;vue-router&quot;: &quot;^3.0.1&quot;</li> <li>&quot;ant-design-vue&quot;: &quot;^1.0.2&quot;    antd框架  vue版本</li> <li>&quot;axios&quot;: &quot;^0.18.0&quot;,</li> <li>&quot;koa&quot;: &quot;^2.5.2&quot;,</li> <li>&quot;koa-router&quot;: &quot;^7.4.0&quot;    koa路由</li> <li>&quot;koa-static&quot;: &quot;^5.0.0&quot;    koa用来托管静态资源的中间件</li> <li>&quot;koa-jwt&quot;: &quot;^3.3.2&quot;    koa用来加密的中间件</li> <li>&quot;mysql&quot;: &quot;^2.16.0&quot;    nodejs的mysql驱动，本地环境需要自己再安装mysql服务（本项目采用的是mysql5.7）</li> <li>&quot;sequelize&quot;: &quot;3.28.0&quot;    操作数据库的ORM<div class="tip custom-block"><p class="custom-block-title">提示</p> <p>尽量保持所有第三库的版本跟上文列出来的一致，以防止因版本不一致而导致的一些奇奇怪怪的bug。</p></div></li></ul> <h2 id="项目结构"><a href="#项目结构" aria-hidden="true" class="header-anchor">#</a> 项目结构</h2> <p>这里用vue-cli来完成demo的前端构建，作者的vue-cli版本是2.9.6</p> <div class="language-bash extra-class"><pre class="language-bash"><code>vue init webpack demo
<span class="token function">cd</span> demo
</code></pre></div><p>安装过程如下图所示：
<img src="/assets/img/vue-cli.69850cad.jpg" alt="An image"></p> <p>前端构建完成后，进入到<code>Demo</code>文件夹，新建一个<code>server</code>文件夹和<code>app.js</code>文件，并在新建的<code>server</code>文件夹里新建<code>config</code>、<code>controllers</code>、<code>models</code>、<code>schema</code>、<code>routes</code>五个文件夹。
最终的项目结构如下图所示：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">.</span>
├── LICENSE
├── README.md
├── app.js  // Koa入口文件
├── build // vue-cli 生成，用于webpack监听、构建
│   ├── build.js
│   ├── check-versions.js
│   ├── dev-client.js
│   ├── dev-server.js
│   ├── logo.png
│   ├── utils.js
│   ├── webpack.base.conf.js
│   ├── webpack.dev.conf.js
│   └── webpack.prod.conf.js
├── config // vue-cli 生成<span class="token operator">&amp;</span>自己加的一些配置文件
│   ├── default.conf
│   ├── dev.env.js
│   ├── index.js
│   └── prod.env.js
├── dist // Vue build 后的文件夹
│   ├── index.html // 入口文件
│   └── static // 静态资源
├── index.html // vue-cli生成，用于容纳Vue组件的主html文件。单页应用就只有一个html
├── package.json // npm的依赖、项目信息文件
├── server // Koa后端，用于提供Api
│   ├── config // 配置文件夹
│   ├── controllers // controller-控制器
│   ├── models // model-模型
│   ├── routes // route-路由
│   └── schema // schema-数据库表结构
├── src // vue-cli 生成<span class="token operator">&amp;</span>自己添加的utils工具类
│   ├── App.vue // 主文件
│   ├── assets // 相关静态资源存放
│   ├── components // 单文件组件
│   ├── main.js // 引入Vue等资源、挂载Vue的入口js
│   └── router // vue前端路由
└── yarn.lock // 用yarn自动生成的lock文件
</code></pre></div><h2 id="启动koa服务"><a href="#启动koa服务" aria-hidden="true" class="header-anchor">#</a> 启动koa服务</h2> <p>打开<code>package.json</code>文件，在<code>&quot;dependencies&quot;</code>的下面加入：</p> <div class="language-json extra-class"><pre class="language-json"><code>//package.json

<span class="token property">&quot;koa&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.5.2&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;koa-bodyparser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.2.1&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;koa-json&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.2&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;koa-jwt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.2&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;koa-router&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.4.0&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;koa-static&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.0.0&quot;</span>
</code></pre></div><p>保存文件，执行</p> <div class="language- extra-class"><pre class="language-text"><code>yarn  //安装koa及其中间件
</code></pre></div><p>安装完成后，打开<code>app.js</code>文件，在里面写入如下内容：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//app.js</span>

<span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">'koa'</span>
<span class="token keyword">import</span> bodyParser <span class="token keyword">from</span> <span class="token string">'koa-bodyparser'</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>                                 <span class="token comment">//监听错误信息</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server is running at http://localhost:3000'</span><span class="token punctuation">)</span>   <span class="token comment">//监控3000端口</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> app
</code></pre></div><p>这里我们用了ES6的<code>import</code>语法，没有用node的<code>require</code>语法,但是如果直接这样写会报错，因为node还不支持<code>import</code>、<code>await</code>等语法，需要借助babel进行转译:</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add babel-register@^6.26.0 --dev
</code></pre></div><p>安装完成后，在<code>Demo</code>文件夹里新建一个<code>index.js</code>文件，在里面写入如下内容：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//index.js</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-core/register'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'presets'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">[</span><span class="token string">'env'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">'targets'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token string">'node'</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./app.js'</span><span class="token punctuation">)</span>
</code></pre></div><p>保存，在终端执行</p> <div class="language-bash extra-class"><pre class="language-bash"><code>node index.js
</code></pre></div><p>这时候如果终端出现：<code>server is running at http://localhost:3000</code>,说明我们的koa2服务器已经启动成功了。</p> <h2 id="构建前端页面"><a href="#构建前端页面" aria-hidden="true" class="header-anchor">#</a> 构建前端页面</h2> <p>这个Demo准备做一个迷你后台管理系统，实现系统的登录、token验证、路由拦截、表格数据的增删改查功能。
前端UI框架选用<code>ant-design-vue</code>,安装：</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add ant-design-vue
</code></pre></div><p>一般开发项目的时候，我们不会把整个框架都引入到项目里，而是采用按需加载都方式，需要安装<code>babel-plugin-import</code>插件：</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add babel-plugin-import --dev
</code></pre></div><p>修改<code>.babelrc</code>文件，配置babel-plugin-import：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>//.babelrc

<span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&quot;env&quot;</span>, <span class="token punctuation">{</span>
      <span class="token string">&quot;modules&quot;</span><span class="token keyword">:</span> false,
      <span class="token string">&quot;targets&quot;</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;browsers&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&gt; 1%&quot;</span>, <span class="token string">&quot;last 2 versions&quot;</span>, <span class="token string">&quot;not ie &lt;= 8&quot;</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>,
    <span class="token string">&quot;stage-2&quot;</span>
  <span class="token punctuation">]</span>,
  <span class="token string">&quot;plugins&quot;</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
     <span class="token string">&quot;transform-vue-jsx&quot;</span>,
     <span class="token string">&quot;transform-runtime&quot;</span>,
     <span class="token punctuation">[</span><span class="token string">&quot;import&quot;</span>, <span class="token punctuation">{</span> <span class="token string">&quot;libraryName&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;ant-design-vue&quot;</span>, <span class="token string">&quot;libraryDirectory&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;es&quot;</span>, <span class="token string">&quot;style&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;css&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>详细修改过程可参考<a href="https://vuecomponent.github.io/ant-design-vue/docs/vue/use-with-vue-cli-cn/" target="_blank" rel="noopener noreferrer">vue-antd-ui官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
我们把需要用到的UI组件一次性导入，打开<code>main.js</code>,改成如下内容：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//main.js</span>

<span class="token comment">// The Vue build version to load with the `import` command</span>
<span class="token comment">// (runtime-only or standalone) has been set in webpack.base.conf with an alias.</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span>Row<span class="token punctuation">,</span>Col<span class="token punctuation">,</span>Form<span class="token punctuation">,</span>Input<span class="token punctuation">,</span>Card<span class="token punctuation">,</span>Select<span class="token punctuation">,</span>DatePicker<span class="token punctuation">,</span>Table<span class="token punctuation">,</span>message<span class="token punctuation">,</span>Pagination<span class="token punctuation">,</span>Modal<span class="token punctuation">,</span>Radio <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ant-design-vue'</span>

Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Button<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Button<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Row<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Row<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Col<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Col<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Input<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Card<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Card<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Select<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Select<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>DatePicker<span class="token punctuation">.</span>name<span class="token punctuation">,</span> DatePicker<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Form<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Form<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Table<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Table<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Pagination<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Pagination<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Modal<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Modal<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Radio<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Radio<span class="token punctuation">)</span>
<span class="token keyword">const</span> FormItem <span class="token operator">=</span> Form<span class="token punctuation">.</span>Item
<span class="token keyword">const</span> Option <span class="token operator">=</span> Select<span class="token punctuation">.</span>Option
<span class="token keyword">const</span> RangePicker <span class="token operator">=</span> DatePicker<span class="token punctuation">.</span>RangePicker
<span class="token keyword">const</span> RadioGroup <span class="token operator">=</span> Radio<span class="token punctuation">.</span>Group
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>FormItem<span class="token punctuation">.</span>name<span class="token punctuation">,</span> FormItem<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>Option<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Option<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>RangePicker<span class="token punctuation">.</span>name<span class="token punctuation">,</span> RangePicker<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>RadioGroup<span class="token punctuation">.</span>name<span class="token punctuation">,</span> RadioGroup<span class="token punctuation">)</span>
Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token comment">/* eslint-disable no-new */</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  router<span class="token punctuation">,</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span><span class="token punctuation">,</span>
  template<span class="token punctuation">:</span> <span class="token string">'&lt;App/&gt;'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p> <p>全局引入<code>antd</code>框架的时候，发现有个问题，比如<code>Form</code>这个组件，在某个组件引用的时候，还必须再单独引入一次，不然会提示<code>Form undefined</code>,如果大家碰到这个问题，就再单独引入一次;另外如果知道产生原因和解决办法的麻烦在下面留言跟我说下，谢谢了。</p></div> <h3 id="登录界面"><a href="#登录界面" aria-hidden="true" class="header-anchor">#</a> 登录界面</h3> <p>在<code>components</code>里面新建一个<code>Login.vue</code>的组件，组件内容如下：</p> <div class="language-vue extra-class"><pre class="language-vue"><code>//Login.vue

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-row</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-card</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>欢迎登录<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-form</span> <span class="token attr-name">@submit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleSubmit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:autoFormCreate</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(form)=&gt;{this.form = form}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-form-item</span>
                <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>username<span class="token punctuation">'</span></span>
                <span class="token attr-name">:labelCol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{ span: 4 }<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">:wrapperCol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{ span: 20 }<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">fieldDecoratorId</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">:fieldDecoratorOptions</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{rules: [{ required: true, message: <span class="token punctuation">'</span>Please input your username!<span class="token punctuation">'</span> }]}<span class="token punctuation">&quot;</span></span>
                <span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-input</span> <span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-form-item</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-form-item</span>
                <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>password<span class="token punctuation">'</span></span>
                <span class="token attr-name">:labelCol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{ span: 4 }<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">:wrapperCol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{ span: 20 }<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">fieldDecoratorId</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">:fieldDecoratorOptions</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{rules: [{ required: true, message: <span class="token punctuation">'</span>Please input your password!<span class="token punctuation">'</span> }]}<span class="token punctuation">&quot;</span></span>
                <span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-input</span> <span class="token punctuation">/&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-form-item</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-form-item</span>
                <span class="token attr-name">:wrapperCol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{ span: 16, offset: 4 }<span class="token punctuation">&quot;</span></span>
              <span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>primary<span class="token punctuation">'</span></span> <span class="token attr-name">htmlType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>submit<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>Submit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-button</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-form-item</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-form</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-card</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-col</span> <span class="token attr-name">:span</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-col</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-row</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Login'</span><span class="token punctuation">,</span>  
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      formLayout<span class="token punctuation">:</span> <span class="token string">'horizontal'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">handleSubmit</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> values<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Received values of form: '</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>保存，修改<code>router</code>文件里的<code>index.js</code>文件,把<code>Login</code>组件添加到前端路由里面：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//index.js</span>

<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'vue-router'</span>
<span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">'@/components/HelloWorld'</span>
<span class="token keyword">import</span> Login <span class="token keyword">from</span> <span class="token string">'@/components/Login'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'HelloWorld'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> HelloWorld
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'Login'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> Login
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>保存，运行<code>yarn dev</code>或者<code>npm run dev</code>启动前端服务，在浏览器网址里输入<code>http://localhost:8080/#/login</code>就能看到如下界面：
<img src="/assets/img/login.faeef076.jpg" alt="An image"></p> <h3 id="后台管理界面"><a href="#后台管理界面" aria-hidden="true" class="header-anchor">#</a> 后台管理界面</h3> <p>接下来我们创建登录成功后跳转的后台管理界面，因为只是做一个Demo，所以打算做一个简单的界面，包含数据的增删改查即可。因为在后面我们将涉及到时间的查询，到时候需要对时间格式的数据进行转换，所以要先安装一下<code>moment</code>，</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add moment
</code></pre></div><p>安装完后在<code>components</code>下新建<code>UserForm.vue</code>,内容如下</p> <div class="language-vue extra-class"><pre class="language-vue"><code>//UserForm.vue

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> Form<span class="token punctuation">,</span> Select<span class="token punctuation">,</span> Radio <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ant-design-vue'</span>
<span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">'moment'</span>
<span class="token keyword">const</span> FormItem <span class="token operator">=</span> Form<span class="token punctuation">.</span>Item
<span class="token keyword">const</span> Option <span class="token operator">=</span> Select<span class="token punctuation">.</span>Option
<span class="token keyword">const</span> RadioGroup <span class="token operator">=</span> Radio<span class="token punctuation">.</span>Group
<span class="token keyword">const</span> CollectionCreateForm <span class="token operator">=</span> Form<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'a-form'</span><span class="token punctuation">:</span> Form<span class="token punctuation">,</span>
      <span class="token string">'a-form-item'</span><span class="token punctuation">:</span> FormItem<span class="token punctuation">,</span>
      <span class="token string">'a-select'</span><span class="token punctuation">:</span> Select<span class="token punctuation">,</span>
      <span class="token string">'a-option'</span><span class="token punctuation">:</span> Option<span class="token punctuation">,</span>
      <span class="token string">'a-radio'</span><span class="token punctuation">:</span> Radio<span class="token punctuation">,</span>
      <span class="token string">'a-radio-group'</span><span class="token punctuation">:</span> RadioGroup
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'visible'</span><span class="token punctuation">,</span> <span class="token string">'selectData'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'userInfo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> visible<span class="token punctuation">,</span> form<span class="token punctuation">,</span> title <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> getFieldDecorator <span class="token punctuation">}</span> <span class="token operator">=</span> form
      <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo <span class="token operator">||</span> <span class="token punctuation">{</span>state<span class="token punctuation">:</span> <span class="token string">'咸鱼一条'</span><span class="token punctuation">,</span> sex<span class="token punctuation">:</span> <span class="token string">'男'</span><span class="token punctuation">,</span> birthday<span class="token punctuation">:</span> <span class="token string">'2000-01-01'</span><span class="token punctuation">,</span> interest<span class="token punctuation">:</span> <span class="token string">'篮球'</span><span class="token punctuation">}</span>
      <span class="token keyword">const</span> formItemLayout <span class="token operator">=</span> <span class="token punctuation">{</span>
        labelCol<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          xs<span class="token punctuation">:</span> <span class="token punctuation">{</span> span<span class="token punctuation">:</span> <span class="token number">8</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          sm<span class="token punctuation">:</span> <span class="token punctuation">{</span> span<span class="token punctuation">:</span> <span class="token number">4</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        wrapperCol<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          xs<span class="token punctuation">:</span> <span class="token punctuation">{</span> span<span class="token punctuation">:</span> <span class="token number">16</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          sm<span class="token punctuation">:</span> <span class="token punctuation">{</span> span<span class="token punctuation">:</span> <span class="token number">20</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> rowObject <span class="token operator">=</span> <span class="token punctuation">{</span>
        minRows<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> maxRows<span class="token punctuation">:</span> <span class="token number">6</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>a<span class="token operator">-</span>modal
          visible<span class="token operator">=</span><span class="token punctuation">{</span>visible<span class="token punctuation">}</span>
          title<span class="token operator">=</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span>
          okText<span class="token operator">=</span><span class="token string">'Create'</span>
          onCancel<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'cancel'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
          onOk<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'create'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a<span class="token operator">-</span>form layout<span class="token operator">=</span><span class="token string">'vertical'</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item
              <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">{</span> props<span class="token punctuation">:</span> formItemLayout <span class="token punctuation">}</span><span class="token punctuation">}</span>
              label<span class="token operator">=</span><span class="token string">'用户名:'</span>
            <span class="token operator">&gt;</span>
              <span class="token punctuation">{</span>title <span class="token operator">===</span> <span class="token string">'用户详情'</span> <span class="token operator">?</span> userInfo<span class="token punctuation">.</span>username
                <span class="token punctuation">:</span> <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                  initialValue<span class="token punctuation">:</span> userInfo<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
                  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                    type<span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">'该用户名有效'</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">'用户名不能为空'</span>
                  <span class="token punctuation">}</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
                  <span class="token operator">&lt;</span>a<span class="token operator">-</span>input placeholder<span class="token operator">=</span><span class="token string">&quot;请输入用户名&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item
              <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">{</span> props<span class="token punctuation">:</span> formItemLayout <span class="token punctuation">}</span><span class="token punctuation">}</span>
              label<span class="token operator">=</span><span class="token string">'性别：'</span>
            <span class="token operator">&gt;</span>
              <span class="token punctuation">{</span>
                title <span class="token operator">===</span> <span class="token string">'用户详情'</span> <span class="token operator">?</span> <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span> <span class="token punctuation">{</span>userInfo<span class="token punctuation">.</span>sex<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
                  <span class="token punctuation">:</span> <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">'sex'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    initialValue<span class="token punctuation">:</span> userInfo<span class="token punctuation">.</span>sex
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
                    <span class="token operator">&lt;</span>a<span class="token operator">-</span>radio<span class="token operator">-</span>group<span class="token operator">&gt;</span>
                      <span class="token operator">&lt;</span>a<span class="token operator">-</span>radio value<span class="token operator">=</span><span class="token string">&quot;男&quot;</span><span class="token operator">&gt;</span>男<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>radio<span class="token operator">&gt;</span>
                      <span class="token operator">&lt;</span>a<span class="token operator">-</span>radio value<span class="token operator">=</span><span class="token string">&quot;女&quot;</span><span class="token operator">&gt;</span>女<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>radio<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>radio<span class="token operator">-</span>group<span class="token operator">&gt;</span>
                  <span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item
              <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">{</span> props<span class="token punctuation">:</span> formItemLayout <span class="token punctuation">}</span><span class="token punctuation">}</span>
              label<span class="token operator">=</span><span class="token string">'状态'</span>
            <span class="token operator">&gt;</span>
              <span class="token punctuation">{</span> title <span class="token operator">===</span> <span class="token string">'用户详情'</span> <span class="token operator">?</span> userInfo<span class="token punctuation">.</span>state
                <span class="token punctuation">:</span> <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                  initialValue<span class="token punctuation">:</span> userInfo<span class="token punctuation">.</span>state
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
                  <span class="token operator">&lt;</span>a<span class="token operator">-</span>select<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;咸鱼一条&quot;</span><span class="token operator">&gt;</span>咸鱼一条<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;风华浪子&quot;</span><span class="token operator">&gt;</span>风华浪子<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;北大才子一枚&quot;</span><span class="token operator">&gt;</span>北大才子一枚<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;百度FE&quot;</span><span class="token operator">&gt;</span>百度<span class="token constant">FE</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;创业者&quot;</span><span class="token operator">&gt;</span>创业者<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
                  <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>select<span class="token operator">&gt;</span>
                <span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item
              <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">{</span> props<span class="token punctuation">:</span> formItemLayout <span class="token punctuation">}</span><span class="token punctuation">}</span>
              label<span class="token operator">=</span><span class="token string">'生日：'</span>
            <span class="token operator">&gt;</span>
              <span class="token punctuation">{</span> title <span class="token operator">===</span> <span class="token string">'用户详情'</span> <span class="token operator">?</span> <span class="token function">moment</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>birthday<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span>
                <span class="token punctuation">:</span> <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">'birthday'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                  initialValue<span class="token punctuation">:</span> <span class="token function">moment</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>birthday<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
                  <span class="token operator">&lt;</span>a<span class="token operator">-</span>date<span class="token operator">-</span>picker
                    showTime
                    format<span class="token operator">=</span><span class="token string">&quot;YYYY-MM-DD&quot;</span>
                  <span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item
              <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">{</span> props<span class="token punctuation">:</span> formItemLayout <span class="token punctuation">}</span><span class="token punctuation">}</span>
              label<span class="token operator">=</span><span class="token string">'爱好'</span> 
            <span class="token operator">&gt;</span>
              <span class="token punctuation">{</span>title <span class="token operator">===</span> <span class="token string">'用户详情'</span> <span class="token operator">?</span> userInfo<span class="token punctuation">.</span>interest
                <span class="token punctuation">:</span> <span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">'interest'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                  initialValue<span class="token punctuation">:</span> userInfo<span class="token punctuation">.</span>interest
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
                  <span class="token operator">&lt;</span>a<span class="token operator">-</span>text<span class="token operator">-</span>area autosize<span class="token operator">=</span><span class="token punctuation">{</span>rowObject<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>form<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>modal<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'userForm'</span><span class="token punctuation">,</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'visible'</span><span class="token punctuation">,</span> <span class="token string">'userInfo'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">handleCancel</span>  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>formRef<span class="token punctuation">.</span>form
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'hideForm'</span><span class="token punctuation">,</span> <span class="token string">'noUpdate'</span><span class="token punctuation">)</span>
      form<span class="token punctuation">.</span><span class="token function">resetFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">handleCreate</span>  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>formRef<span class="token punctuation">.</span>form
      form<span class="token punctuation">.</span><span class="token function">resetFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'hideForm'</span><span class="token punctuation">,</span> <span class="token string">'update'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">saveFormRef</span>  <span class="token punctuation">(</span>formRef<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>formRef <span class="token operator">=</span> formRef
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>CollectionCreateForm
          wrappedComponentRef<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>saveFormRef<span class="token punctuation">}</span>
          visible<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>visible<span class="token punctuation">}</span>
          userInfo<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>userInfo<span class="token punctuation">}</span>
          title<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">}</span>
          onCancel<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleCancel<span class="token punctuation">}</span>
          onCreate<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleCreate<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>接着在<code>components</code>下新建<code>SearchForm.vue</code>,内容如下</p> <div class="language-vue extra-class"><pre class="language-vue"><code>//SearchForm.vue

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> Form<span class="token punctuation">,</span> Select <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ant-design-vue'</span>
<span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">'moment'</span>
<span class="token keyword">import</span> <span class="token string">'moment/locale/zh-cn'</span>
moment<span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">'zh-cn'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> FormItem <span class="token operator">=</span> Form<span class="token punctuation">.</span>Item
<span class="token keyword">const</span> Option <span class="token operator">=</span> Select<span class="token punctuation">.</span>Option
<span class="token keyword">const</span> SearchForm <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'SearchForm'</span><span class="token punctuation">,</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'a-form'</span><span class="token punctuation">:</span> Form<span class="token punctuation">,</span>
    <span class="token string">'a-form-item'</span><span class="token punctuation">:</span> FormItem<span class="token punctuation">,</span>
    <span class="token string">'a-select'</span><span class="token punctuation">:</span> Select<span class="token punctuation">,</span>
    <span class="token string">'a-option'</span><span class="token punctuation">:</span> Option
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">handleSubmit</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> values<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Received values of form: '</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">handleReset</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">resetFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> getFieldDecorator <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>form
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>a<span class="token operator">-</span>card<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a<span class="token operator">-</span>form id<span class="token operator">=</span><span class="token string">'components-form-demo-normal-register'</span> style<span class="token operator">=</span><span class="token string">&quot;float:left;&quot;</span> layout<span class="token operator">=</span><span class="token string">&quot;inline&quot;</span> onSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item label<span class="token operator">=</span><span class="token string">'生日:'</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">'birthday'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>a<span class="token operator">-</span>range<span class="token operator">-</span>picker<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>range<span class="token operator">-</span>picker<span class="token operator">&gt;</span>
            <span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item label<span class="token operator">=</span><span class="token string">'状态:'</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
              initialValue<span class="token punctuation">:</span> <span class="token string">'全部'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>a<span class="token operator">-</span>select style<span class="token operator">=</span><span class="token string">&quot;width:100px;&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;全部&quot;</span><span class="token operator">&gt;</span>全部<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;咸鱼一条&quot;</span><span class="token operator">&gt;</span>咸鱼一条<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;风华浪子&quot;</span><span class="token operator">&gt;</span>风华浪子<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;北大才子一枚&quot;</span><span class="token operator">&gt;</span>北大才子一枚<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;百度FE&quot;</span><span class="token operator">&gt;</span>百度<span class="token constant">FE</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;创业者&quot;</span><span class="token operator">&gt;</span>创业者<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>select<span class="token operator">&gt;</span>
            <span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
           <span class="token operator">&lt;</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item label<span class="token operator">=</span><span class="token string">'性别:'</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token function">getFieldDecorator</span><span class="token punctuation">(</span><span class="token string">'sex'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
              initialValue<span class="token punctuation">:</span> <span class="token string">'全部'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>a<span class="token operator">-</span>select style<span class="token operator">=</span><span class="token string">&quot;width:100px;&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;全部&quot;</span><span class="token operator">&gt;</span>全部<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;男&quot;</span><span class="token operator">&gt;</span>男<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>a<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">&quot;女&quot;</span><span class="token operator">&gt;</span>女<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>option<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>select<span class="token operator">&gt;</span>
            <span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>a<span class="token operator">-</span>button type<span class="token operator">=</span><span class="token string">'primary'</span> htmlType<span class="token operator">=</span><span class="token string">'submit'</span> style<span class="token operator">=</span><span class="token string">&quot;margin:0 20px&quot;</span><span class="token operator">&gt;</span>查询<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>a<span class="token operator">-</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleReset<span class="token punctuation">}</span> <span class="token operator">&gt;</span>重置<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>button<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>form<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>card<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Form<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>SearchForm<span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>接着在<code>components</code>下新建<code>UserTable.vue</code>,内容如下:</p> <div class="language-vue extra-class"><pre class="language-vue"><code>//UserTable.vue

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-card</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-table</span>
        <span class="token attr-name">bordered</span>
        <span class="token attr-name">:columns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>columns<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:dataSource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:rowSelection</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>rowSelection<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:pagination</span><span class="token attr-value"><span class="token punctuation">=</span>false</span>
      <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-pagination</span> <span class="token attr-name">showQuickJumper</span> <span class="token attr-name">:defaultCurrent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>params.page<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:total</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>total<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onChangePage<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">float</span><span class="token punctuation">:</span>right<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span>10px -9px 0 0<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-card</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> dataSource <span class="token keyword">from</span> <span class="token string">'./data'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Table'</span><span class="token punctuation">,</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'requestList'</span><span class="token punctuation">,</span><span class="token string">'updataData'</span><span class="token punctuation">,</span><span class="token string">'searchParams'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      dataSource<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      selectedRows<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      selectedRowKeys<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      pagination<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      columns<span class="token punctuation">:</span> dataSource<span class="token punctuation">.</span>columns<span class="token punctuation">,</span>
      total<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      params<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        page<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        pageSize<span class="token punctuation">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      requestListFlag<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requestList
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">requestList</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">updataData</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'receiveTable'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>updataData<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">searchParams</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/searchOperator'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>searchParams<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>result<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            item<span class="token punctuation">.</span>key <span class="token operator">=</span> index
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          _this<span class="token punctuation">.</span>dataSource <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>result
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">rowSelection</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token string">'radio'</span><span class="token punctuation">,</span>
        onChange<span class="token punctuation">:</span> <span class="token punctuation">(</span>selectedRowKeys<span class="token punctuation">,</span> selectedRows<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          _this<span class="token punctuation">.</span>selectedRowKeys <span class="token operator">=</span> selectedRowKeys
          _this<span class="token punctuation">.</span>selectedRows <span class="token operator">=</span> selectedRows
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`selectedRowKeys: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>selectedRowKeys<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> <span class="token string">'selectedRows: '</span><span class="token punctuation">,</span> selectedRows<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        onSelect<span class="token punctuation">:</span> <span class="token punctuation">(</span>record<span class="token punctuation">,</span> selected<span class="token punctuation">,</span> selectedRows<span class="token punctuation">,</span> nativeEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'receiveTable'</span><span class="token punctuation">,</span> record<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 动态获取数据</span>
    <span class="token function">request</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onChangePage</span> <span class="token punctuation">(</span>pageNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>page <span class="token operator">=</span> pageNumber
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>最后修改<code>HelloWord.vue</code>文件，把刚才新建的三个组件添加进去，内容如下所示：</p> <div class="language-vue extra-class"><pre class="language-vue"><code>//HelloWord.vue

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>search-form</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>search-form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-card</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">margin-top</span><span class="token punctuation">:</span>-1px<span class="token punctuation">;</span><span class="token property">margin-bottom</span><span class="token punctuation">:</span> -1px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>plus<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleOperator(<span class="token punctuation">'</span>create<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>创建员工<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-button</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>edit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleOperator(<span class="token punctuation">'</span>edit<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>编辑员工<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleOperator(<span class="token punctuation">'</span>detail<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>员工详情<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>danger<span class="token punctuation">&quot;</span></span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>delete<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleOperator(<span class="token punctuation">'</span>delete<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>删除员工<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-card</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user-table</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hackReset<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>receiveTable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>receiveTable<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:requestList</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>requestList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:updataData</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>updataData<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:searchParams</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>searchParams<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user-table</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user-form</span>
      <span class="token attr-name">:visible</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>visible<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:userInfo</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userInfo<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:requestList</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>requestList<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name"><span class="token namespace">v-on:</span>hideForm</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hideForm<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user-form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">import</span> UserTable <span class="token keyword">from</span> <span class="token string">'./UserTable'</span>
<span class="token keyword">import</span> UserForm <span class="token keyword">from</span> <span class="token string">'./UserForm'</span>
<span class="token keyword">import</span> SearchForm <span class="token keyword">from</span> <span class="token string">'./SearchForm'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'User'</span><span class="token punctuation">,</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    UserTable<span class="token punctuation">,</span>
    UserForm<span class="token punctuation">,</span>
    SearchForm
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      visible<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      userInfo<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      selectItem<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      title<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      requestList<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      hackReset<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 操作员工</span>
    <span class="token function">handleOperator</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http
      <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">let</span> deleteId
      <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'create'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'创建员工'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">// 因为共用一个Form表单，当用户新建员工时，即使选中了table里面的某一行数据，打开的From表单应该只有默认值，所以这里要清空userInfo；通过selectItem来判断用户有没有选中table的数据</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'edit'</span> <span class="token operator">||</span> type <span class="token operator">===</span> <span class="token string">'detail'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectItem<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Modal<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            title<span class="token punctuation">:</span> <span class="token string">'信息'</span><span class="token punctuation">,</span>
            content<span class="token punctuation">:</span> <span class="token string">'请选择一个用户'</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'edit'</span> <span class="token operator">?</span> <span class="token string">'编辑用户'</span> <span class="token punctuation">:</span> <span class="token string">'用户详情'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span>
        deleteId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectItem<span class="token punctuation">.</span>id
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'delete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectItem<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Modal<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            title<span class="token punctuation">:</span> <span class="token string">'信息'</span><span class="token punctuation">,</span>
            content<span class="token punctuation">:</span> <span class="token string">'请选择一个用户'</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        Modal<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          content<span class="token punctuation">:</span> <span class="token string">'确定要删除此用户吗？'</span><span class="token punctuation">,</span>
          onOk<span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
              url<span class="token punctuation">:</span> <span class="token string">'/api/deletePersonnelTable'</span><span class="token punctuation">,</span>
              method<span class="token punctuation">:</span> <span class="token string">'post'</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
              id<span class="token punctuation">:</span> deleteId
            <span class="token punctuation">}</span>
            <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> options<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token string">'删除成功'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 通知UserTable更新数据</span>
              _this<span class="token punctuation">.</span>requestList <span class="token operator">=</span> <span class="token operator">!</span>_this<span class="token punctuation">.</span>requestList
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">hideForm</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span>
         <span class="token comment">//更新完数据，通知UserTable更新数据</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">===</span> <span class="token string">'update'</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">!==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>requestList <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>requestList
        <span class="token keyword">this</span><span class="token punctuation">.</span>updataData <span class="token operator">=</span> params
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">===</span> <span class="token string">'update'</span> <span class="token operator">&amp;&amp;</span> params <span class="token operator">==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建完数据，通知UserTable更新数据</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>requestList <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>requestList
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">receiveTable</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo <span class="token operator">=</span> data
      <span class="token keyword">this</span><span class="token punctuation">.</span>selectItem <span class="token operator">=</span> data
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
<span class="token selector">.button</span> <span class="token punctuation">{</span>
  <span class="token property">float</span><span class="token punctuation">:</span>left<span class="token punctuation">;</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>全部修改完后，重新运行<code>yarn dev</code>,在浏览器地址输入<code>http://localhost:8080/#/</code>,就会看到以下画面：
<img src="/assets/img/table.a586973f.jpg" alt="An image"></p> <h2 id="搭建后端环境"><a href="#搭建后端环境" aria-hidden="true" class="header-anchor">#</a> 搭建后端环境</h2> <h3 id="mysql"><a href="#mysql" aria-hidden="true" class="header-anchor">#</a> mysql</h3> <p>如果本地还没有配置好<code>mysql</code>的开发环境，可以去<a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener noreferrer">官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>下载<code>MySQL Community Server</code>并安装，</p> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>在安装软件的过程中，要记得复制<code>mysql</code>的初始密码，安装完后再改成自己记得住的密码，如<code>123456</code></p></div> <p>大家根据自己的电脑系统选择相应的版本下载就行，我安装的是<code>mac版的5.7.23</code>.
然后安装可视化工具来操作我们的本地数据库，我们使用官方的<a href="https://dev.mysql.com/downloads/workbench/" target="_blank" rel="noopener noreferrer">workbench<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，不需要破解就能免费使用，因为要配合我们的本地<code>mysql</code>版本，<code>workbench</code>的版本选择<code>6.3.10</code>。
安装完后打开<code>workbench</code>软件，连接本地数据库。默认端口是：3306，用户名：root，这里的密码不要使用初始密码，不然可能会连接不上，用更改过后的密码登录。
登录成功后，新建一个名为<code>Demo</code>的schema，在<code>Demo</code>里新建两张table，一张是<code>user</code>，一张是<code>management</code>,如下图：</p> <div style="text-align: center"><img src="/assets/img/workbench-1.b8235887.jpg"></div> <p><code>user</code>表的内容如下：
</p><div style="text-align: left;width:450px;margin:0 auto;"><table><tr><th width="150px">字段</th> <th width="150px">类型</th> <th width="150px">说明</th></tr> <tr><td>id</td> <td>int(自增)</td> <td>用户的id</td></tr> <tr><td>username</td> <td>VARCHAR(45)</td> <td>用户名字</td></tr> <tr><td>password </td> <td>VARCHAR(128)</td> <td>用户密码</td></tr></table></div><p></p> <p><code>management</code>表的内容如下：
</p><div style="text-align: left;width:450px;margin:0 auto;"><table><tr><th width="150px">字段</th> <th width="150px">类型</th> <th width="150px">说明</th></tr> <tr><td>id</td> <td>int(自增)</td> <td>用户的id</td></tr> <tr><td>username</td> <td>VARCHAR(45)</td> <td>用户名字</td></tr> <tr><td>sex </td> <td>VARCHAR(45)</td> <td>性别</td></tr> <tr><td>state </td> <td>VARCHAR(45)</td> <td>状态</td></tr> <tr><td>interest </td> <td>VARCHAR(45)</td> <td>爱好</td></tr> <tr><td>birthday </td> <td>DATE</td> <td>生日</td></tr></table></div><p></p> <h3 id="sequelize"><a href="#sequelize" aria-hidden="true" class="header-anchor">#</a> Sequelize</h3> <p>感谢互联网的大神们带我们走过了刀耕火种的时代，有了<code>vue</code>、<code>react</code>这样优秀的MVVM框架，我们再也不用去为了操作DOM而头疼，当然，我们也不需要再用原生的<code>sql</code>语句去和数据库打交道。现在流行把关系数据库的表结构映射到对象上，也就是传说中的ORM技术-Object-Relational Mapping。在本教程里，使用为node量身打造的<a href="http://docs.sequelizejs.com/" target="_blank" rel="noopener noreferrer">Sequelize<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，在<a href="https://github.com/sequelize/sequelize" target="_blank" rel="noopener noreferrer">github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>上已经有了15000多个star了。开始安装：</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add mysql@^2.16.0    //安装mysql驱动
yarn global add sequelize-auto@^0.4.29 //自动生成schema
yarn add sequelize@^3.28.0 
</code></pre></div><p>进入server的目录，执行如下语句sequelize-auto -o &quot;./schema&quot; -d Demo -h 127.0.0.1 -u root -p 3306 -x XXXXX -e mysql，（其中 -o 参数后面的是输出的文件夹目录， -d 参数后面的是数据库名， -h 参数后面是数据库地址， -u 参数后面是数据库用户名， -p 参数后面是端口号， -x 参数后面是数据库密码，这个根据自己的数据库密码来！ -e 参数后面指定数据库为mysql）</p> <p>然后就会在schema文件夹下自动生成两个<code>management.js</code>和<code>user.js</code>两个文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//management.js</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> DataTypes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'management'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      primaryKey<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      autoIncrement<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    username<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    sex<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    state<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    interest<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    birthday<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATEONLY</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    tableName<span class="token punctuation">:</span> <span class="token string">'management'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// user.js</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> DataTypes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      primaryKey<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      autoIncrement<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    username<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    tableName<span class="token punctuation">:</span> <span class="token string">'user'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>用<code>sequelize-auto</code>能够根据数据库里的字段自动帮我们定义表结构。生成的数据库表结构文件也都自动帮我们module.exports出来了，可以直接导入到别的文件使用。</p> <p>在<code>server</code>目录下的<code>config</code>目录下我们新建一个<code>db.js</code>，用于初始化Sequelize和数据库的连接。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// db.js</span>

<span class="token keyword">const</span> Sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sequelize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 引入sequelize</span>
<span class="token comment">// 使用url连接的形式进行连接</span>
<span class="token keyword">const</span> Demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">'mysql://root:XXXX@localhost/Demo'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  define<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    timestamps<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment">// 取消Sequelzie自动给数据表加入时间戳（createdAt以及updatedAt）</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  Demo <span class="token comment">// 将Demo暴露出接口方便Model调用</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">更改密码</p> <p>要将root后面的<code>XXXX</code>换成自己的本读数据库秘密</p></div> <p>在<code>models</code>文件夹里将数据库和表结构文件连接起来。在这个文件夹下新建一个<code>user.js</code>的文件。我们先来写一个查询用户id的东西。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// models/user.js</span>
<span class="token keyword">import</span> db <span class="token keyword">from</span> <span class="token string">'../config/db.js'</span> <span class="token comment">// 引入user的表结构</span>
<span class="token keyword">const</span> userModel <span class="token operator">=</span> <span class="token string">'../schema/user.js'</span>
<span class="token keyword">const</span> DemoDb <span class="token operator">=</span> db<span class="token punctuation">.</span>Demo <span class="token comment">// 引入数据-</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> DemoDb<span class="token punctuation">.</span><span class="token keyword">import</span><span class="token punctuation">(</span>userModel<span class="token punctuation">)</span> <span class="token comment">// 用sequelize的import方法引入表结构，实例化了basicTable。</span>

<span class="token keyword">const</span> getUserById <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">{</span> 
  <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 用await控制异步操作，将返回的Promise对象里的数据返回出来。也就实现了“同步”的写法获取异步IO操作的数据</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> id
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> userInfo <span class="token comment">// 返回数据</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  getUserById  <span class="token comment">// 导出getUserById的方法，将会在controller里调用</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接着我们在controllers写一个user的controller，来执行这个方法，并返回结果：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//controllers/user.js</span>
<span class="token keyword">import</span> user <span class="token keyword">from</span> <span class="token string">'../models/user.js'</span>
<span class="token keyword">const</span> getUserInfo <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token comment">// 获取url里传过来的参数里的id</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 通过await“同步”地返回查询结果</span>
  ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> result <span class="token comment">// 将请求的结果放到response的body里返回</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  getUserInfo <span class="token comment">// 把获取用户信息的方法暴露出去 </span>
<span class="token punctuation">}</span> <span class="token comment">// 把获取用户信息的方法暴露出去 </span>
<span class="token punctuation">}</span>
</code></pre></div><p>下面需要定义路由，前端需要通过指定的路由，才能够调用这个方法。
::: 提示
为了省事，教程里的所有请求都采用post请求
:::</p> <p>在<code>routes</code>文件夹下新建一个<code>router.js</code>的文件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//routes/router.js</span>

<span class="token keyword">import</span> KoaRouter <span class="token keyword">from</span> <span class="token string">'koa-router'</span>
<span class="token keyword">import</span> UserController <span class="token keyword">from</span> <span class="token string">'./../controllers/user.js'</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">KoaRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>app<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> UserController<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">)</span> <span class="token comment">//用POST请求</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>把路由挂载到<code>Koa</code>上，修改<code>app.js</code>文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js</span>

<span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">'koa'</span>
<span class="token keyword">import</span> bodyParser <span class="token keyword">from</span> <span class="token string">'koa-bodyparser'</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./server/routes/router'</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">router</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server is running at http://localhost:3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>

</code></pre></div><p>最后，我们在数据库里随意加一条数据用来测试：
</p><div style="text-align: center"><img src="/assets/img/test.3d2b71ad.jpg"></div><p></p> <p>打开终端，输入node index.js，如果终端打印出<code>server is running at http://localhost:3000</code>，说明我们的API可以进行测试了！</p> <h3 id="测试api"><a href="#测试api" aria-hidden="true" class="header-anchor">#</a> 测试API</h3> <p>API的测试工具这里选用<a href="https://www.getpostman.com/" target="_blank" rel="noopener noreferrer">postman<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，如果没有安装该软件的话自己去官网下载安装一下，打开软件开始测试,方法选<code>post</code>,地址<code>http://localhost:3000/user/1</code>,点击<code>send</code>测试,结果如下图：
</p><div style="text-align: center"><img src="/assets/img/testApi.a23b6226.jpg"></div><p></p> <p>成功拿到数据库里的数据，说明我们的API没有问题。</p> <h2 id="登录功能"><a href="#登录功能" aria-hidden="true" class="header-anchor">#</a> 登录功能</h2> <p>用户的登录验证我们采用目前比较火的<code>JSON-WEB-TOKEN</code>验证方式，相比于基于cookie或者session的登录验证jwt是真正的无状态请求，不占用服务器的资源，不存在跨域的问题，简单说说
jwt的原理:</p> <ul><li>用户输入账号密码登录，会把账户密码（密码用md5加密）发送给后端</li> <li>后端验证用户的账号和密码信息，如果匹配，就返回一个TOKEN给客户端；如果验证失败，就返回验证错误信息</li> <li>登录成功成功后，客户端会将服务器返回的TOKE保存下来（SessionStorage、LocalStorage）,之后要请求其他资源的时候，在请求头（Header）里带上这个TOKEN进行请求</li> <li>后面服务器在收到客户端的请求时，会先验证一下TOKEN是否有效，有效则返回请求的资源，无效则返回验证错误
更详细的关于<code>JSON-WEB-TOKEN</code>的介绍，可参考<a href="http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html" target="_blank" rel="noopener noreferrer">阮一峰的博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
通过这个TOKEN的方式，客户端和服务端之间的访问，是无状态的：也就是服务端不知道你这个用户到底还在不在线，只要你发送的请求头里的TOKEN是正确的我就给你返回你想要的资源。这样能够不占用服务端宝贵的空间资源，而且如果涉及到服务器集群，如果服务器进行维护或者迁移或者需要CDN节点的分配的话，无状态的设计显然维护成本更低。
安装<code>jwt</code>:</li></ul> <div class="language- extra-class"><pre class="language-text"><code>yarn add koa-jwt
</code></pre></div><p>在<code>models</code>里的<code>user.js</code>新加一个通过用户名查找用户的方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// models/user.js</span>
<span class="token comment">// ......</span>
<span class="token comment">// 前面的省略了</span>


<span class="token comment">// 新增一个方法，通过用户名查找</span>
<span class="token keyword">const</span> getUserByName <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      username<span class="token punctuation">:</span> name
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> userInfo
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  getUserById<span class="token punctuation">,</span> <span class="token comment">// 导出getUserById的方法，将会在controller里调用</span>
  getUserByName
<span class="token punctuation">}</span>
</code></pre></div><p>接着修改<code>controllers</code>里的<code>user.js</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// controllers/user.js</span>
<span class="token comment">// ......</span>
<span class="token comment">// 前面的省略了</span>


<span class="token comment">// 新增一个方法，通过用户名查找</span>
<span class="token keyword">const</span> getUserAuth <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span> <span class="token comment">// post过来的数据存在request.body里</span>
  <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">getUserByName</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>userInfo <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 如果查无此用户会返回null</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>password <span class="token operator">!=</span> data<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// success标志位是方便前端判断返回是正确与否</span>
        info<span class="token punctuation">:</span> <span class="token string">'密码错误！'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token comment">// 如果密码正确</span>
      <span class="token keyword">const</span> userToken <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> userInfo<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
        id<span class="token punctuation">:</span> userInfo<span class="token punctuation">.</span>id
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> secret <span class="token operator">=</span> <span class="token string">'vue-koa-demo'</span><span class="token punctuation">;</span> <span class="token comment">// 指定密钥，这是之后用来判断token合法性的标志</span>
      <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>userToken<span class="token punctuation">,</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 签发token</span>
      ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        success<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        token<span class="token punctuation">:</span> token<span class="token punctuation">,</span> <span class="token comment">// 返回token</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      info<span class="token punctuation">:</span> <span class="token string">'用户不存在！'</span> <span class="token comment">// 如果用户不存在返回用户不存在</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p> <p><code>userToken</code>里面的内容是可以自定义的，加密后存储在token里返回给前端，前端如果想拿到token里面的内容，需要解码，安装<code>koa-jwt</code>，从<code>koa-jwt</code>导入<code>jwt</code>，然后调用<code>jwt.decode(token)</code>拿到<code>userToken</code>里面的内容。</p></div> <p>更新一下<code>router.js</code>规则：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//router.js</span>

<span class="token keyword">import</span> KoaRouter <span class="token keyword">from</span> <span class="token string">'koa-router'</span>
<span class="token keyword">import</span> UserController <span class="token keyword">from</span> <span class="token string">'./../controllers/user.js'</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">KoaRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>app<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> UserController<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">)</span>
  router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/user'</span><span class="token punctuation">,</span> UserController<span class="token punctuation">.</span>getUserAuth<span class="token punctuation">)</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>后端API写完了，我们开始写前端请求</p> <h3 id="axios"><a href="#axios" aria-hidden="true" class="header-anchor">#</a> Axios</h3> <p><a href="https://github.com/axios/axios" target="_blank" rel="noopener noreferrer">axios<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个基于Promise用于浏览器和nodejs的 HTTP客户端,非常火，在github上已经有了将近50000个star了，具体的使用方法大家可以参考官网，文档写的非常详细。先安装一下<code>axios</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add axios
</code></pre></div><p>在<code>src\main.js</code>里引入axios，</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// scr/main.js</span>

<span class="token comment">// ...</span>

<span class="token keyword">import</span> Axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$http <span class="token operator">=</span> Axios <span class="token comment">// 绑定到Vue的$http实例上</span>

<span class="token comment">// ...</span>
</code></pre></div><p>修改<code>Login.vue</code>,编写登录方法<code>handleSubmit</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Login.vue</span>
<span class="token comment">// 省略前面的部分</span>

  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">handleSubmit</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> values<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> values<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
            password<span class="token punctuation">:</span> values<span class="token punctuation">.</span>password
          <span class="token punctuation">}</span> 
          <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/user'</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token comment">// 将信息发送给后端</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// axios返回的数据都在res.data里</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>success<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 如果成功</span>
                sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'demo-token'</span><span class="token punctuation">,</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token comment">// 用sessionStorage把token存下来</span>
                message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'登录成功'</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token comment">// 进入后台管理页面，登录成功</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                 <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>info<span class="token punctuation">)</span> <span class="token comment">// 登录失败，显示提示语</span>
                 sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'demo-token'</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 将token清空</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'请求错误！'</span><span class="token punctuation">)</span>
              sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'demo-token'</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token comment">// 将token清空</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>登录框里的<code>username</code>和<code>password</code>的值，<code>antd</code>这个框架都帮我们封装在了<code>this.form.validateFields((err, values)</code>里的<code>values</code>这个参数里面了。</p> <h3 id="bcryptjs-密码加密"><a href="#bcryptjs-密码加密" aria-hidden="true" class="header-anchor">#</a> bcryptjs-密码加密</h3> <p>以前，我们习惯前端用md5给信息加密再提交给后端，但是后来发现这种方式并不安全，因为html是明文传输，即使是加密后的数据也能被第三方截取，他们可以直接拿着加密后的信息去后端请求数据；所以前端加密并不太靠谱，最安全的方式是采用<code>https传输协议</code>，加密的步骤放在后端。为什么需要后端加密呢？假如你登录过的某个网站数据库被攻击导致数据泄露，而你的密码是以明文保存在数据库的，那么黑客就可以拿你的密码去撞库，因为我们经常好几个网站的密码都是相同的，那意味着一个网站被攻击，你其他的网站的数据也不安全了。
安装bcryptjs：</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add bcryptjs
</code></pre></div><p>在<code>controllers/user.js</code>引入<code>bcryptjs</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//controllers/user.js</span>
<span class="token keyword">import</span> bcrypt <span class="token keyword">from</span> <span class="token string">'bcryptjs'</span>
<span class="token comment">// 省略前面的部分</span>

 <span class="token keyword">if</span> <span class="token punctuation">(</span>userInfo <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果查无此用户会返回null</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bcrypt<span class="token punctuation">.</span><span class="token function">compareSync</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>password<span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span>dataValues<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 验证密码是否正确</span>
      ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// success标志位是方便前端判断返回是正确与否</span>
        info<span class="token punctuation">:</span> <span class="token string">'密码错误！'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 如果密码正确</span>
<span class="token comment">// 省略后面的部分  </span>
</code></pre></div><p>然后我们需要把我们数据库里<code>123</code>这个明文密码bcrypt化，加密后变为：<code>$2a$10$x3f0Y2SNAmyAfqhKVAV.7uE7RHs3FDGuSYw.LlZhOFoyK7cjfZ.Q6</code>，替换数据库里的<code>123</code>.</p> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>如果我们做注册功能，用户注册成功后提交到后端的密码，需要我们用bcrypt加密后再存到数据库里,不要把密码等敏感信息用明文的方式存到数据库里</p></div> <h3 id="跨域"><a href="#跨域" aria-hidden="true" class="header-anchor">#</a> 跨域</h3> <p>在进行前后端联调的时候，我们还得解决跨域的问题。像现在，我们的koa服务器跑在<code>3000</code>端口，而前端是跑在<code>webpack</code>为我们提供的<code>8080</code>端口，端口不一样，存在跨域的情况，没法直接传输数据。解决跨域通信的方法常用的两种方法：</p> <ol><li>服务端在请求头上加上<code>CORS</code>允许跨域，客户端即可用类似<code>axios</code>这样的工具跨域发送请求</li> <li>变成同域
如果使用第一种方法的话，可以借助<a href="https://github.com//cors" target="_blank" rel="noopener noreferrer">koajs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>这个中间件
如果前端人员也能自己解决跨域的问题，那我们就没必要麻烦后端了，这里我们选用第二种办法。
打开根目录下<code>config/index.js</code>文件，找到<code>dev</code>下的<code>proxyTable</code>，利用这个<code>proxyTable</code>这个代理工具，把外部的请求通过webpack转发给本地，也就把跨域请求变成同域请求了：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//config/index.js</span>

前面省略
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  dev<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// Paths</span>
    assetsSubDirectory<span class="token punctuation">:</span> <span class="token string">'static'</span><span class="token punctuation">,</span>
    assetsPublicPath<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    proxyTable<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'/api'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          target<span class="token punctuation">:</span> <span class="token string">'http://localhost:3000'</span><span class="token punctuation">,</span>
          changeOrigin<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    省略<span class="token operator">...</span>
</code></pre></div><p><code>proxyTable</code>的作用是：当我们在组件里发出的请求地址是/api/xxxx的时候，实际上请求的是http://localhost:3000/api/xxxx，由于webpack帮我们代理了localhost的3000端口的服务，所以我们可以把实际是跨域的请求当做是同域下的接口来调用。</p> <p>然后重新启动一下前端<code>webpack</code>服务，先<code>ctrl+c</code>退出当前进程，然后<code>yarn dev</code>或者<code>npm run dev</code>,输入网址<code>http://localhost:8080/#/login</code>,输入账号<code>test</code>,密码<code>123</code>,然后登录：
</p><div style="text-align: center"><img src="/assets/img/login.86dd726b.gif"></div>
登录成功，我们打开浏览器的后台查看<code>Session Storage</code>:
<div style="text-align: center"><img src="/assets/img/token.f5611172.jpg"></div>
后端返回给我们的<code>token</code>也已经被保存下来了。<p></p> <h3 id="路由拦截"><a href="#路由拦截" aria-hidden="true" class="header-anchor">#</a> 路由拦截</h3> <p>在前端服务刚启动的时候或者手动修改地址栏的地址改成<code>http://localhost:8080/</code>也会跳转到管理页面，这与我们的需求违背，我们需要用户登录成功后才能跳转到管理后台:
</p><div style="text-align: center"><img src="/assets/img/unloginTest.15540c12.gif"></div>
这里就要用到后端给我们传回来的<code>token</code>,有token就说明我们的身份是经过验证的，可以跳转到后台管理页面，否则就是非法的。我们用<code>vue-router</code>做一下前端的全局拦截，打开<code>src/main.js</code>，加入以下内容：<p></p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">//src/main.js</span>
前面省略
Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'demo-token'</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>requiresAuth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">!==</span> <span class="token string">'null'</span> <span class="token operator">&amp;&amp;</span> token <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//判断是否存在token</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      message<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">'请先登录'</span><span class="token punctuation">)</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>打开<code>src/router/index.js</code>,改成如下内容：</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">//src/router/index.js</span>
前面省略
routes<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'HelloWorld'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> HelloWorld<span class="token punctuation">,</span>
      meta<span class="token punctuation">:</span> <span class="token punctuation">{</span>requiresAuth<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>   <span class="token comment">//表示进入HelloWorld页面是需要验证的</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">'Login'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> Login
    <span class="token punctuation">}</span>
</code></pre></div><p>重启服务器<code>npm run dev</code>,或者直接清除浏览器缓存刷新网页，保证<code>token</code>被清除掉就行，会发现在未登录的情况下，无法跳转到后台管理页面，说明拦截功能生效了。
</p><div style="text-align: center"><img src="/assets/img/loginTest.fcb80ab4.gif"></div><p></p> <h2 id="实现员工的增删改查"><a href="#实现员工的增删改查" aria-hidden="true" class="header-anchor">#</a> 实现员工的增删改查</h2> <p>这部分就是后台系统很常见的功能、也是主要的功能了,把这部分内容都完成了，一个后台的管理系统也基本完成的七七八八了。</p> <h3 id="发送token"><a href="#发送token" aria-hidden="true" class="header-anchor">#</a> 发送Token</h3> <p>前面在用户登录成功后，服务器会给客户端返回一个token，那么以后客户端每次发送请求都要带上token，服务器验证通过了才会返回数据。
因为我们用了<code>koa-jwt</code>，所以只需要在每条请求头上加上<code>Authorization</code>属性，值是<code>Bearer {token值}</code>，然后让Koa在接收请求之前验证一下token即可，我们把<code>token</code>绑定到<code>axios</code>的<code>header</code>里，这样每次发送请求默认都会带上<code>token</code>了。</p> <p>打开<code>src/main.js</code>，在路由跳转的钩子里加上这句：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//main.js</span>

<span class="token operator">...</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'demo-token'</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>requiresAuth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">!==</span> <span class="token string">'null'</span> <span class="token operator">&amp;&amp;</span> token <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 全局设定header的token验证,注意Bearer后有个空格</span>
      Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$http<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>common<span class="token punctuation">[</span><span class="token string">'Authorization'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Bearer '</span> <span class="token operator">+</span> token 
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      message<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">'请先登录'</span><span class="token punctuation">)</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="获取数据"><a href="#获取数据" aria-hidden="true" class="header-anchor">#</a> 获取数据</h3> <p>我们先在数据库里手动添加一条数据，然后再写一个获取数据库里数据的方法。</p> <p></p><div style="text-align: center"><img src="/assets/img/baobao.07be599b.jpg"></div><p></p> <p>打开<code>server/models/management.js</code>，新增一个<code>getOperator</code>方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//models/management.js</span>

<span class="token keyword">import</span> db <span class="token keyword">from</span> <span class="token string">'../config/db.js'</span> <span class="token comment">// 引入user的表结构</span>
<span class="token keyword">const</span> managementModel <span class="token operator">=</span> <span class="token string">'../schema/management.js'</span>
<span class="token keyword">const</span> DemoDb <span class="token operator">=</span> db<span class="token punctuation">.</span>Demo <span class="token comment">// 引入数据</span>
<span class="token keyword">const</span> Management <span class="token operator">=</span> DemoDb<span class="token punctuation">.</span><span class="token keyword">import</span><span class="token punctuation">(</span>managementModel<span class="token punctuation">)</span> <span class="token comment">// 用sequelize的import方法引入表结构</span>
<span class="token keyword">const</span> getOperator <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> personnelTable<span class="token punctuation">.</span><span class="token function">findAndCountAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    offset<span class="token punctuation">:</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> params<span class="token punctuation">.</span>pageSize<span class="token punctuation">,</span>
    limit<span class="token punctuation">:</span> params<span class="token punctuation">.</span>pageSize
  <span class="token punctuation">}</span><span class="token punctuation">)</span> 
  <span class="token keyword">return</span> result <span class="token comment">// 返回数据</span>
<span class="token punctuation">}</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    getOperator
  <span class="token punctuation">}</span>
</code></pre></div><p>通常数据库里的数据都是成千上万条的，如果一次性获取全部数据，一来是数据库读取速度慢，二来前端页面一下子渲染这么多数据也会需要较长时间，所以我们一般采用分页这种友好的方式去获取数据，这里选用里<code>findAndCountAll</code>这个方法，<code>offset</code>表示页码，<code>limit</code>表示每页的数据条数；如果要一次性获取全部的数据，可以用<code>findAll</code>这个方法。</p> <p>同样需要修改<code>controller/management.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//controllers/management.js</span>

<span class="token keyword">import</span> management <span class="token keyword">from</span> <span class="token string">'../models/management.js'</span>
<span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">'moment'</span>
<span class="token keyword">import</span> <span class="token string">'moment/locale/zh-cn'</span>
moment<span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">'zh-cn'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> getOperator <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> management<span class="token punctuation">.</span><span class="token function">getOperator</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      success<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      result<span class="token punctuation">:</span> result
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      data<span class="token punctuation">:</span> <span class="token string">'获取数据出错'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

 <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    getOperator
  <span class="token punctuation">}</span>
</code></pre></div><p>更新路由<code>routes/router.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//routes/router.js</span>
<span class="token keyword">import</span> ManagementController <span class="token keyword">from</span> <span class="token string">'./../controllers/management.js'</span>
<span class="token keyword">import</span> jwt <span class="token keyword">from</span> <span class="token string">'koa-jwt'</span>
<span class="token operator">...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>app<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> UserController<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">)</span>
  router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/user'</span><span class="token punctuation">,</span> UserController<span class="token punctuation">.</span>getUserAuth<span class="token punctuation">)</span>
  router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/getOperator'</span><span class="token punctuation">,</span> <span class="token function">jwt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>secret<span class="token punctuation">:</span> <span class="token string">'vue-koa-demo'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ManagementController<span class="token punctuation">.</span>getOperator<span class="token punctuation">)</span>
</code></pre></div><p>这里的<code>jwt({secret: 'vue-koa-demo'})</code>就是要求前端如果想获取<code>/api/getOperator</code>这个API的数据，就必须带上<code>token</code>，也就是之前用户登录成功后服务器返回给用户的<code>token</code>，我们在上文已经把这个<code>token</code>绑定到<code>axios</code>的请求头上了。</p> <p>修改<code>app.js</code>,捕捉<code>jwt</code>验证失败的错误信息：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//app.js</span>
<span class="token operator">...</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//  如果JWT验证失败，返回验证失败信息</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">401</span>
      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        token<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        info<span class="token punctuation">:</span> <span class="token string">'没有权限'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> err
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
</code></pre></div><p>接着我们需要在前端发起数据的请求了，这个请求应该在我们页面刚加载的时候就去服务器里请求数据，所以我们在<code>mounted()</code>方法里面调用获取数据的方法，修改<code>src/components/userTable.vue</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//userTable.vue</span>
<span class="token operator">...</span>

 <span class="token comment">// 动态获取数据</span>
     <span class="token keyword">async</span> <span class="token function">request</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'/api/getOperator'</span>
      <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params
      <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>params<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>rows<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            item<span class="token punctuation">.</span>key <span class="token operator">=</span> index
          <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token comment">//给每条数据添加唯一的key值</span>
          _this<span class="token punctuation">.</span>total <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>count
          _this<span class="token punctuation">.</span>dataSource <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>rows
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

 <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre></div><p>然后我们刷新一下页面，会发现我们已经拿到刚才添加到数据库里面的两条数据了：</p> <div style="text-align: center"><img src="/assets/img/get.80142e79.jpg"></div> <h3 id="添加数据、更新数据、删除数据"><a href="#添加数据、更新数据、删除数据" aria-hidden="true" class="header-anchor">#</a> 添加数据、更新数据、删除数据</h3> <p>上图中的四个按键功能<code>创建员工</code> <code>编辑员工</code> <code>员工详情</code> <code>删除员工</code>在前端页面里都共用了一个model，所以打算把四个按键功能的方法也通过封装的方式写在一起。</p> <p>修改<code>server/models/management.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//models/management.js</span>
<span class="token operator">...</span>

<span class="token comment">// 新增数据</span>
<span class="token keyword">const</span> createOperator <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span> 
  <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token keyword">await</span> Management<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 用await控制异步操作，将返回的Promise对象里的数据返回出来。也就实现了“同步”的写法获取异步IO操作的数据</span>
      username<span class="token punctuation">:</span> data<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
      sex<span class="token punctuation">:</span> data<span class="token punctuation">.</span>sex<span class="token punctuation">,</span>
      state<span class="token punctuation">:</span> data<span class="token punctuation">.</span>state<span class="token punctuation">,</span>
      interest<span class="token punctuation">:</span> data<span class="token punctuation">.</span>interest<span class="token punctuation">,</span>
      birthday<span class="token punctuation">:</span> data<span class="token punctuation">.</span>birthday
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> userInfo <span class="token comment">// 返回数据</span>
<span class="token punctuation">}</span>

<span class="token comment">// 更新数据</span>
<span class="token keyword">const</span> updateOperator <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> Management<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      username<span class="token punctuation">:</span> data<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
      sex<span class="token punctuation">:</span> data<span class="token punctuation">.</span>sex<span class="token punctuation">,</span>
      state<span class="token punctuation">:</span> data<span class="token punctuation">.</span>state<span class="token punctuation">,</span>
      interest<span class="token punctuation">:</span> data<span class="token punctuation">.</span>interest<span class="token punctuation">,</span>
      birthday<span class="token punctuation">:</span> data<span class="token punctuation">.</span>birthday
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> data<span class="token punctuation">.</span>id
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> result <span class="token comment">// 返回数据</span>
<span class="token punctuation">}</span>

<span class="token comment">//删除数据</span>
<span class="token keyword">const</span> deleteOperator <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> Management<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> params<span class="token punctuation">.</span>id
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> result <span class="token comment">// 返回数据</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  createOperator<span class="token punctuation">,</span> <span class="token comment">// 导出createOperator的方法，将会在controller里调用</span>
  getOperator<span class="token punctuation">,</span>
  deleteOperator<span class="token punctuation">,</span>
  updateOperator
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre></div><p>同样需要修改<code>controller/management.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//controller/management.js</span>
<span class="token operator">...</span>

<span class="token comment">//更新数据</span>
<span class="token keyword">const</span> updateOperator <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
  data<span class="token punctuation">.</span>birthday <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>birthday<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> management<span class="token punctuation">.</span><span class="token function">updateOperator</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      success<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      result<span class="token punctuation">:</span> result
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      result<span class="token punctuation">:</span> <span class="token string">'更新失败'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//删除数据</span>
<span class="token keyword">const</span> deleteOperator <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> management<span class="token punctuation">.</span><span class="token function">deleteOperator</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      success<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      result<span class="token punctuation">:</span> <span class="token string">'删除成功'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      data<span class="token punctuation">:</span> <span class="token string">'删除失败'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  createOperator<span class="token punctuation">,</span> <span class="token comment">// 导出createOperator的方法，将会在router.js里调用</span>
  getOperator<span class="token punctuation">,</span>
  deleteOperator<span class="token punctuation">,</span>
  updateOperator
<span class="token punctuation">}</span>
</code></pre></div><p>更新路由<code>routes/router.js</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>`routes/router.js`
...

router.post('/api/createOperator', jwt({secret: 'vue-koa-demo'}), ManagementController.createOperator)
  router.post('/api/deleteOperator', jwt({secret: 'vue-koa-demo'}), ManagementController.deleteOperator)
  router.post('/api/updateOperator', jwt({secret: 'vue-koa-demo'}), ManagementController.updateOperator)
  
  ...
</code></pre></div><p>修改<code>userForm.vue</code>里面的<code>handleCreate</code>方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//userForm.vue</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Form<span class="token punctuation">,</span> Select<span class="token punctuation">,</span> Radio<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ant-design-vue'</span>
<span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">'moment'</span>
<span class="token keyword">const</span> FormItem <span class="token operator">=</span> Form<span class="token punctuation">.</span>Item
<span class="token keyword">const</span> Option <span class="token operator">=</span> Select<span class="token punctuation">.</span>Option
<span class="token keyword">const</span> RadioGroup <span class="token operator">=</span> Radio<span class="token punctuation">.</span>Group
<span class="token operator">...</span>

<span class="token keyword">async</span> <span class="token function">handleCreate</span>  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>formRef<span class="token punctuation">.</span>form
      <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
      form<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> values<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
          username<span class="token punctuation">:</span> values<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
          sex<span class="token punctuation">:</span> values<span class="token punctuation">.</span>sex<span class="token punctuation">,</span>
          state<span class="token punctuation">:</span> values<span class="token punctuation">.</span>state<span class="token punctuation">,</span>
          birthday<span class="token punctuation">:</span> values<span class="token punctuation">.</span>birthday<span class="token punctuation">,</span>
          interest<span class="token punctuation">:</span> values<span class="token punctuation">.</span>interest<span class="token punctuation">,</span>
          id<span class="token punctuation">:</span> _this<span class="token punctuation">.</span>title <span class="token operator">===</span> <span class="token string">'创建员工'</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> _this<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>id
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> url<span class="token operator">=</span> _this<span class="token punctuation">.</span>title <span class="token operator">===</span> <span class="token string">'创建员工'</span> <span class="token operator">?</span> <span class="token string">'/api/createOperator'</span> <span class="token punctuation">:</span> <span class="token string">'/api/updateOperator'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>params<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>id <span class="token punctuation">)</span> <span class="token punctuation">{</span>
              message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'创建成功'</span><span class="token punctuation">)</span>
              form<span class="token punctuation">.</span><span class="token function">resetFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              _this<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'hideForm'</span><span class="token punctuation">,</span> <span class="token string">'update'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'更新成功'</span><span class="token punctuation">)</span>
              _this<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'hideForm'</span><span class="token punctuation">,</span> <span class="token string">'update'</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>最后修改<code>Helloword.vue</code>里面的<code>handleOperator</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//Helloword.vue</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Modal<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ant-design-vue'</span>
<span class="token keyword">import</span> UserTable <span class="token keyword">from</span> <span class="token string">'./UserTable'</span>
<span class="token keyword">import</span> UserForm <span class="token keyword">from</span> <span class="token string">'./UserForm'</span>
<span class="token keyword">import</span> SearchForm <span class="token keyword">from</span> <span class="token string">'./SearchForm'</span>
<span class="token operator">...</span>
<span class="token comment">//操作员工</span>
    <span class="token comment">// 操作员工</span>
    <span class="token function">handleOperator</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">let</span> deleteId
      <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'create'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'创建员工'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">// 因为共用一个Form表单，当用户新建员工时，即使选中了table里面的某一行数据，打开的From表单应该只有默认值，所以这里要清空userInfo；通过selectItem来判断用户有没有选中table的数据</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'edit'</span> <span class="token operator">||</span> type <span class="token operator">===</span> <span class="token string">'detail'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectItem<span class="token punctuation">.</span>id <span class="token operator">==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Modal<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            title<span class="token punctuation">:</span> <span class="token string">'信息'</span><span class="token punctuation">,</span>
            content<span class="token punctuation">:</span> <span class="token string">'请选择一个用户'</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'edit'</span> <span class="token operator">?</span> <span class="token string">'编辑用户'</span> <span class="token punctuation">:</span> <span class="token string">'用户详情'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userInfo <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectItem
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'delete'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        deleteId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectItem<span class="token punctuation">.</span>id
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>selectItem<span class="token punctuation">.</span>id  <span class="token operator">==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          Modal<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            title<span class="token punctuation">:</span> <span class="token string">'信息'</span><span class="token punctuation">,</span>
            content<span class="token punctuation">:</span> <span class="token string">'请选择一个用户'</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        Modal<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          content<span class="token punctuation">:</span> <span class="token string">'确定要删除此用户吗？'</span><span class="token punctuation">,</span>
          onOk<span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">'/api/deleteOperator'</span>
            <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
              id<span class="token punctuation">:</span> deleteId
            <span class="token punctuation">}</span>
            _this<span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>params<span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>result <span class="token operator">===</span> <span class="token string">'删除成功'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">'删除成功'</span><span class="token punctuation">)</span>
                     <span class="token keyword">this</span><span class="token punctuation">.</span>requestList<span class="token operator">=</span> <span class="token operator">!</span>_this<span class="token punctuation">.</span>requestList
                     <span class="token keyword">this</span><span class="token punctuation">.</span>selectItem<span class="token punctuation">.</span>id <span class="token operator">=</span> undefined
                     <span class="token keyword">this</span><span class="token punctuation">.</span>hackReset <span class="token operator">=</span> <span class="token boolean">false</span>
                     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                     <span class="token keyword">this</span><span class="token punctuation">.</span>hackReset <span class="token operator">=</span> <span class="token boolean">true</span>
                     <span class="token punctuation">}</span><span class="token punctuation">)</span>  
                  <span class="token punctuation">}</span>
               <span class="token punctuation">}</span><span class="token punctuation">)</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>好了，下面让我们来看下效果：</p> <div style="text-align: center"><img src="/assets/img/operator.63196570.gif"></div> <p>OK！没问题。</p> <p>如果看了代码，会发现其实操作数据库没有那么难(感谢大神们🙏)，增、删、改、查分别都有对应的方法可以调用</p> <h3 id="数据查找"><a href="#数据查找" aria-hidden="true" class="header-anchor">#</a> 数据查找</h3> <p>最后，我们做一下按条件查找的功能，这个教程就接近尾声了。其实做到这里，整个前后端交互逻辑，大家应该都已经比较清楚了。<code>router</code>作为前端的访问路径，<code>controllers</code>是前后端数据交互的缓冲层，<code>model</code>是后端访问数据库的方法。</p> <p>修改<code>server/models/management.js</code>,新增<code>searchOperator</code>方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//models/management.js`</span>
<span class="token operator">...</span>
<span class="token comment">// 按设置条件进行查找</span>
<span class="token keyword">const</span> searchOperator <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  params<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">'全部'</span> <span class="token operator">?</span> params<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'咸鱼一条'</span><span class="token punctuation">,</span> <span class="token string">'风华浪子'</span><span class="token punctuation">,</span> <span class="token string">'北大才子一枚'</span><span class="token punctuation">,</span> <span class="token string">'百度FE'</span><span class="token punctuation">,</span> <span class="token string">'创业者'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> params<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">[</span>params<span class="token punctuation">.</span>state<span class="token punctuation">]</span>
  params<span class="token punctuation">.</span>sex <span class="token operator">===</span> <span class="token string">'全部'</span> <span class="token operator">?</span> params<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'男'</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> params<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token punctuation">[</span>params<span class="token punctuation">.</span>sex<span class="token punctuation">]</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> Management<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        $<span class="token keyword">in</span><span class="token punctuation">:</span> params<span class="token punctuation">.</span>state
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      sex<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        $<span class="token keyword">in</span><span class="token punctuation">:</span> params<span class="token punctuation">.</span>sex
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      birthday<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        $between<span class="token punctuation">:</span> <span class="token punctuation">[</span>params<span class="token punctuation">.</span>birthday<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>birthday<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> 
  <span class="token keyword">return</span> result <span class="token comment">// 返回数据</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre></div><p>修改<code>server/controllers/management.js</code>,新增<code>searchOperator</code>方法：</p> <div class="language-js extra-class"><pre class="language-js"><code>controllers<span class="token operator">/</span>management<span class="token punctuation">.</span>js
<span class="token operator">...</span>
<span class="token keyword">const</span> searchOperator <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  data<span class="token punctuation">.</span>birthday<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>birthday<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span>
  data<span class="token punctuation">.</span>birthday<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>birthday<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> management<span class="token punctuation">.</span><span class="token function">searchOperator</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      success<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      result<span class="token punctuation">:</span> result
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
      success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      data<span class="token punctuation">:</span> <span class="token string">'获取数据出错'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre></div><p>更新<code>routes/router.js</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// router.js`</span>
<span class="token operator">...</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/searchOperator'</span><span class="token punctuation">,</span> <span class="token function">jwt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>secret<span class="token punctuation">:</span> <span class="token string">'vue-koa-demo'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ManagementController<span class="token punctuation">.</span>searchOperator<span class="token punctuation">)</span>
<span class="token operator">...</span>
</code></pre></div><p>更改前端页面<code>SearchFrom.vue</code>里面的<code>handleSubmit</code>方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">handleSubmit</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validateFields</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> values<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 如果用户没有选择时间段，就给一个大范围的时间段搜索范围</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>values<span class="token punctuation">.</span>birthday<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            values<span class="token punctuation">.</span>birthday <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            values<span class="token punctuation">.</span>birthday<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">1900</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span>
            values<span class="token punctuation">.</span>birthday<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'searchOperator'</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>我们来看下最终的效果：</p> <div style="text-align: center"><img src="/assets/img/search.9a6dac23.gif"></div> <p>大功告成。</p> <h2 id="项目部署"><a href="#项目部署" aria-hidden="true" class="header-anchor">#</a> 项目部署</h2> <p>到这里，说明我们的项目在开发环境跑起来是没问题了，但是如果我们想让别人也能访问咱们的网站，就需要部署到服务器上，也就是所谓的生产环境。</p> <p>我们要做的就是把<code>Vue</code>和<code>Koa</code>结合起来变成一个完整的项目,将Vue的静态文件交给Koa“托管”，所有访问前端的请求全部走Koa端，包括静态文件资源的请求，也走Koa端，把Koa作为一个Vue项目的静态资源服务器，这样的话也就不存在跨域的问题了（相当于，之前开发模式是webpack开启了一个服务器托管了Vue的资源和请求，现在生产模式下改成Koa托管Vue的资源和请求）。</p> <h3 id="webpack打包"><a href="#webpack打包" aria-hidden="true" class="header-anchor">#</a> webpack打包</h3> <p>运行<code>yarn build</code>或者<code>npm run build</code>,打包前端文件，打包 完成后会在根目录生成一个<code>dist</code>的文件夹，打包出来<code>dist</code>文件夹有<code>6.5MB</code>，这么大显然不能直接用，我们要优化下。</p> <p>找到根目录下的<code>config/index.js</code>，把<code>productionSourceMap: true</code>这句话改成<code>productionSourceMap: false</code>，这句话到意思是取消输出<code>map</code>文件；把<code>productionGzip: false,</code>改成<code>productionGzip: true,</code>这句话到意思是开启<code>gzip</code>压缩，我们再安装一个压缩文件的插件：<code>yarn add compression-webpack-plugin -D</code></p> <p>最后后再执行<code>npm run build --report</code>，这时候浏览器会打开一个新的窗口<code>http://127.0.0.1:8888/</code>,在这里，我们可以很方便的看到打包完文件的体积大小，以及各种第三方库、插件详细打包信息，后期如果还想优化，就可以参照这些信息对一些体积较大的文件进行优化。</p> <div style="text-align: center"><img src="/assets/img/build.37c94c45.gif"></div> <p>如果开启了<code>gzip</code>后，文件大小也就300多KB,还能接受。</p> <h3 id="koa托管静态资源"><a href="#koa托管静态资源" aria-hidden="true" class="header-anchor">#</a> koa托管静态资源</h3> <p>这里需要借助<code>koa-static</code>这个中间件，我们前面已经安装过了，如果没安装的自己再安装一遍。</p> <p>打开<code>app.js</code>，引入两个新依赖，其中<code>path</code>是nodejs原生自带：</p> <div class="language-j s extra-class"><pre class="language-j"><code><span class="token adverb builtin">/</span><span class="token adverb builtin">/</span> ap<span class="token verb keyword">p.</span>js
import serve from <span class="token string">'koa-static'</span>
import path from <span class="token string">'path'</span>
<span class="token adverb builtin">/</span><span class="token adverb builtin">/</span> <span class="token conjunction variable">..</span><span class="token conjunction variable">..</span> 

router<span class="token punctuation">(</span>app<span class="token punctuation">)</span>
ap<span class="token verb keyword">p.</span>use<span class="token punctuation">(</span>serve<span class="token punctuation">(</span>path<span class="token conjunction variable">.</span>resolve<span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token adverb builtin">/</span><span class="token adverb builtin">/</span> 将webpack打包好的项目目录作为Koa静态文件服务的目录
ap<span class="token verb keyword">p.</span>listen<span class="token punctuation">(</span><span class="token number">3000</span><span class="token verb keyword">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token verb keyword">=</span><span class="token verb keyword">&gt;</span> <span class="token verb keyword">{</span>
  consol<span class="token verb keyword">e.</span>log<span class="token punctuation">(</span><span class="token string">'server is running at http://localhost:3000'</span><span class="token punctuation">)</span>
<span class="token adverb builtin">}</span><span class="token punctuation">)</span>

<span class="token adverb builtin">/</span><span class="token adverb builtin">/</span> <span class="token conjunction variable">..</span><span class="token conjunction variable">.</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p> <p><code>注意app.use(serve(path.resolve('dist')))</code>这句话要放在<code>router(app)</code>的后面，koa的运行机制是谁先被use，谁的规则就先执行，如果我们放到router(app)前面，那么每次发送API请求的时候，都会先给我们返回一个完整的页面，再返回数据</p></div> <p>保存，重新运行<code>node index.js</code>，看到<code>server is running at http://localhost:3000</code>，打开<code>http://localhost:3000</code>,会发现自动跳转到登录页面：</p> <div style="text-align: center"><img src="/assets/img/koaLogin.1acdc926.jpg"></div> <p>剩下的，如果自己有服务器，把代码拷贝一份到服务器上，在服务器里执行<code>node index.js</code>开启服务，别人通过访问你的服务器ip或者服务器域名，加上3000端口号，就能访问到你的项目了，比如我的<a href="http://132.232.73.32:3000/" target="_blank" rel="noopener noreferrer">项目地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是<code>http://132.232.73.32:3000/</code>.</p> <h2 id="写在最后"><a href="#写在最后" aria-hidden="true" class="header-anchor">#</a> 写在最后</h2> <p>本来以为两天就能写完的教程，没想到写了一个多星期，因为时间关系，还有很多东西没写，比如<code>vue</code>、<code>ant-design-vue</code>的使用，好在这些东西都不算很难，官网给的文档也很详细，大家如果有兴趣可以自己去了解了解，有问题的话可以下方给我评论。另外如果想自己独立做一个完整的后台管理系统，可以学习下慕课网河畔一角老师的<a href="https://coding.imooc.com/class/236.html" target="_blank" rel="noopener noreferrer">React全家桶+AntD
共享单车后台管理系统开发<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>课程，非常适合新手，我自己做的管理后台很多代码封装、模块化、代码结构等都参考了老师的课程。</p> <p>虽然这真的只是一个很简单的小项目，但所谓<code>麻雀虽小，五脏俱全</code>，我们毕竟是完成了一个从前端到后端，从本地到服务器的完整项目。借助<code>node</code>以及<code>koa</code>这样小巧而优秀的框架，再稍微了解一点数据结构的知识，我们前端开发人员也能独立的作出一个完整的网站出来，想想真的是太棒了。</p> <p>最后放上完整项目的Github<a href="https://github.com/GongJS/vue-antd-management" target="_blank" rel="noopener noreferrer">地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，以及本Demo的github<a href="https://github.com/GongJS/koa-demo" target="_blank" rel="noopener noreferrer">地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>如果这个项目对你有帮助，希望大家可以fork，给我提建议，如果再有时间，可以点个Star那就更好啦~</p></div> <div class="page-edit"><!----> <!----></div> <!----> <div class="bsa-cpc-wrapper"><div class="bsa-cpc"></div></div> <div class="vcomment"><div id="vcomments"></div></div></div> <!----></div></div>
    <script src="/assets/js/13.3a3e1803.js" defer></script><script src="/assets/js/app.e2588eef.js" defer></script>
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?c3446600de53c605ba4f6c792e47dff9";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  </body>
</html>
